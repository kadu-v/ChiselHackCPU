class Spi {
    static int stCtlRegAddr;
    static int rxRegAddr;
    static int txRegAddr;

    function void init() {
        let stCtlRegAddr = 8195;
        let rxRegAddr = 8196;
        let txRegAddr = 8197;
        return;
    }

    function void _send(bool isCmd, bool is16bit, int d) {
        var int status;
        var int cmdOrDataOr16bit;
        var int is16bit;
        let status = 1;
        let cmdOrDataOr16bit = 32; // 0000_0000_0010_0000

        // wait until Spi Mastet is not busy
        while(
            (status & 1) = 1
        ) {
            let status = Memory.peek(stCtlRegAddr);
        }

        // Write a transmitted data
        do Memory.poke(txRegAddr, d);

        if (isCmd) {
            let cmdOrDataOr16bit = 96; // 0000_0000_0110_0000
        }

        if(is16bit) {
            let cmdOrDataOr16bit = cmdOrDataOr16bit + 128; // 0000_0000_1000_0000
        }

        // start to send data of a data
        do Memory.poke(stCtlRegAddr, cmdOrDataOr16bit);
        return;
    }

    function void sendCmd(int d) {
        do Spi._send(true, false, d);
        return;
    }

    function void send8Data(int d) {
        do Spi._send(false, false, d);
        return;
    }

    function void send16Data(int d) {
        do Spi._send(false, true, d);
        return;
    }
}